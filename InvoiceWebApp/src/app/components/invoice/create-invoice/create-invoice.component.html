<a class="return my-3" [routerLink]="['/invoices']" title="Return">
    <i class="fa fa-arrow-left"></i>
</a>

<div class="row justify-content-around">
    <div class="col-sm-12 col-md-10 col-lg-10 mx-auto table-responsive">
        <form *ngIf="invoice">

            <h4 class="text-muted">Invoice Information</h4>

            <div class="form-group row">
                <div class="col-sm-6">
                    <label>Debtor</label>
                    <app-debtor-dropdown (chosenDebtor)="getDebtorChoice($event)"></app-debtor-dropdown>
                </div>
                <div class="col-sm-6"></div>
            </div>

            <br />

            <div class="form-group row">
                <div class="col-sm-6">
                    <label for="created">Invoice Date</label>
                    <input type="date" name="creation_date" class="form-control" id="created" [min]="minDate" [(ngModel)]="begin" (change)="setExpired()" autofocus required />
                </div>
                <div class="col-sm-6">
                    <label for="expired">Due Date</label>
                    <input type="date" name="expiration_date" class="form-control" id="expired" [min]="minDate" [(ngModel)]="expiration" required />
                </div>
            </div>

            <h4 class="text-muted">Invoice Details</h4>

            <div class="form-group row">
                <div class="col-sm-6">
                    <label for="total">To be paid</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">&euro;</span>
                        </div>
                        <input type="text" name="total" class="form-control" id="total" [ngModel]="invoice.total | number: '1.2-2'" (ngModelChange)="invoice.total=$event" readonly />
                    </div>
                </div>
                <div class="col-sm-6">
                    <label for="discount">Discount</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">&euro;</span>
                        </div>
                        <input class="form-control" name="discount" id="discount" [(ngModel)]="invoice.discount" (change)="calculateTotal()" (blur)="calculateTotal(row)" required currencyMask />
                    </div>
                </div>
            </div>

            <div class="form-group row">
                <div class="col-sm-12">
                    <table class="table table-sm table-striped w-100">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Price</th>
                                <th>Qty</th>
                                <th>Tax</th>
                                <th>Total</th>
                                <th class="text-center"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="table-row" *ngFor="let row of invoice.items;let i = index">
                                <td>
                                    <input type="text" name="p_name" class="form-control form-control-sm" [(ngModel)]="row.name" required />
                                </td>
                                <td>
                                    <input type="text" name="desc" class="form-control form-control-sm" [(ngModel)]="row.description" />
                                </td>
                                <td>
                                    <input name="price" class="form-control form-control-sm" [(ngModel)]="row.price" (change)="calculatePrice(row)" (blur)="calculatePrice(row)" currencyMask />
                                </td>
                                <td>
                                    <input type="number" name="qnt" class="form-control form-control-sm" [(ngModel)]="row.quantity" min="1" (change)="calculatePrice(row)" (blur)="calculatePrice(row)" required />
                                </td>
                                <td>
                                    <input type="number" name="tax" class="form-control form-control-sm" [(ngModel)]="row.tax" min="0" required />
                                </td>
                                <td>
                                    <span style="font-weight: 500;">
                                        &euro; {{ row.total | number:'1.2-2' }}
                                    </span>
                                </td>
                                <td>
                                    <a *ngIf="i >= 1" class="btn-delete" (click)="deleteRow(row)" title="Remove">
                                        <i class="fa fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <a class="btn btn-primary btn-sm" (click)="addRow()" title="Add">
                        <i class="fa fa-plus"></i>
                    </a>
                </div>
            </div>

            <br />

            <div class="form-group row">
                <div class="col-sm-6">
                    <label for="comment">Comment</label>
                    <textarea rows="3" name="comment" class="form-control" id="comment" [(ngModel)]="invoice.comment"></textarea>
                </div>
                <div class="col-sm-6"></div>
            </div>

            <br />

            <button type="button" class="btn btn-primary float-right my-4" (click)="submitForm(false)">Save</button>
            <button type="button" class="btn btn-primary float-right my-4 mr-1" (click)="submitForm(true)">Save as concept</button>
        </form>
    </div>
</div>